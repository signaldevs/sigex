# https://taskfile.dev

version: '3'

tasks:
  build:
    desc: build the go binary in dev mode and install
    deps:
      - clean
    cmds:
      - go build -o bin/sigex
      - go install
  build-prod:
    desc: build binaries for production
    deps:
      - clean
    cmds:
      - go build -o bin/sigex
      - GOOS=darwin GOARCH=amd64 go build -o bin/darwin-amd64/sigex
      - GOOS=windows GOARCH=amd64 go build -o bin/windows-amd64/sigex.exe
  clean:
    desc: clean the build directory
    cmds:
      - rm -rf bin
  test:
    desc: run unit tests
    cmds:
      - go test -cover -v ./...
  example:
    desc: run the example node app
    cmds:
      - >
        sigex
        -f examples/node/config/.dev.env
        -f examples/node/.env
        -e CLI_VAR=SomeCLIVar
        node examples/node/app.js
